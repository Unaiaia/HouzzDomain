"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},actionCallbackMap={};function isSafari(){return"object"===("undefined"==typeof safari?"undefined":_typeof(safari))}function isSafariBackground(){return!!safari.application}function isSafariContent(){return isSafari()&&!isSafariBackground()}function isIframe(e){return isRemoteIframe(e)||isExtensionIframe(e)}function isRemoteIframe(e){var a=document.domain;e&&(a=e);var t=window.self!==window.top,n=-1!==a.indexOf("localhost"),i=-1!==a.indexOf("houzz.com");return t&&(n||i)}function isExtensionIframe(e){var a=document.domain;e&&(a=e);var t=window.self!==window.top,n=-1!==a.indexOf("com.houzz");return t&&n}function sendMessage(e,a){var t=e.action,n=e.data;if(isSafari()){if(!t.split("-")[1])t=t+"-"+Date.now()+Math.floor(100*Math.random());if(isSafariBackground()){var i=safari.application.activeBrowserWindow;i&&i.activeTab.page&&(i.activeTab.page.dispatchMessage(t,n),a&&"function"==typeof a&&registerOnMessage(t,a))}else safari.self.tab.dispatchMessage(t,n),a&&"function"==typeof a&&registerOnMessage(t,a)}else browser.runtime.sendMessage({action:t,data:n},a)}function sendMessageToCurrentTab(e,a,t){e.action,e.data;if(isSafari()){if(sendMessage(e,t),a){var n=safari.application.activeBrowserWindow.activeTab,i=n.title,o=n.url;currentPageInfo={title:i,url:o}}}else browser.tabs.query({active:!0,currentWindow:!0},function(t){a&&(currentPageInfo={title:t[0].title,url:t[0].url}),browser.tabs.sendMessage(t[0].id,e)})}function onMessage(e){e&&"function"==typeof e&&(isSafari()?isSafariBackground()?safari.application.addEventListener("message",function(a){var t={action:a.name,data:a.message};e(t,null,function(e){sendMessage(e)})}):safari.self.addEventListener("message",function(a){var t={action:a.name,data:a.message};e(t)}):browser.runtime.onMessage.addListener(e))}function registerOnMessage(e,a){isSafari()?actionCallbackMap[e]=a:onMessage(a)}function storageGet(e,a){if(e&&"object"===(void 0===e?"undefined":_typeof(e))&&"function"==typeof a)if(isSafari())if(isSafariBackground()){if(localStorage){var t={},n=Object.keys(e),i=Object.keys(localStorage);n.forEach(function(a){if(-1===i.indexOf(a)){var t=e[a];localStorage.setItem(a,t)}}),i.forEach(function(e){var a=localStorage.getItem(e);"null"===a&&(a=null),isJSON(a)&&(a=JSON.parse(a)),t[e]=a}),a&&"function"==typeof a&&a(t)}}else sendMessage({action:"storageGet",data:e},a);else browser.storage.local.get(e,a)}function storageSet(e,a){if(e&&"object"===(void 0===e?"undefined":_typeof(e)))if(isSafari())if(isSafariBackground()){if(localStorage)Object.keys(e).forEach(function(a){var t=e[a];"string"!=typeof t&&"number"!=typeof t&&(t=JSON.stringify(t)),localStorage.setItem(a,t)});a&&"function"==typeof a&&a()}else sendMessage({action:"storageSet",data:e},a);else browser.storage.local.set(e,a)}function onAddressbarIconDisplay(){isSafari()?safari.application.addEventListener("validate",function(e){var a=e.target;a.identifier===addressbarID&&(a.disabled=!1,safari.application.activeBrowserWindow&&isOnBlacklistSite(safari.application.activeBrowserWindow.activeTab.url)&&(a.disabled=!0))}):browser.tabs.onActivated.addListener(function(){browser.tabs.query({active:!0,currentWindow:!0},function(e){e[0]&&(isOnBlacklistSite(e[0].url)?browser.browserAction.disable():browser.browserAction.enable())})})}function createContextMenu(){isSafari()?safari.application.addEventListener("contextmenu",function(e){if(!isOnBlacklistSite(e.target.url)){var a=getTranslatedText("pluginTitle")?getTranslatedText("pluginTitle"):"Houzz Save Button";e.contextMenu.appendContextMenuItem(contextMenuID,a)}}):browser.contextMenus.removeAll(function(){browser.contextMenus.create({title:"Save to Houzz",contexts:["page","frame","selection","link","editable","image","video","audio","page_action"],id:contextMenuID})})}function contextualMenuOnClick(e){e&&"function"==typeof e&&(isSafari()?registerOnMessage(contextMenuID,e):browser.contextMenus.onClicked.addListener(e))}function addressbarIconOnClick(e){e&&"function"==typeof e&&(isSafari()?registerOnMessage(addressbarID,e):browser.browserAction.onClicked.addListener(e))}function newTabOnCreate(e){e&&"function"==typeof e&&(isSafari()?registerOnMessage("beforeNavigate",e):browser.tabs.onCreated.addListener(e))}function updateNewTabUrl(e,a){isSafari()?(e.preventDefault(),e.target.url=getURL(a)):browser.tabs.update(e.id,{url:a})}function getURL(e){return isSafari()?safari.extension.baseURI+e:browser.extension.getURL(e)}function getCookie(e,a){a&&"function"==typeof a&&(isSafari()?sendMessage({action:"getCookie",data:e},a):browser.cookies.get(e,a))}function getTranslatedText(e,a){if("string"==typeof e){var t=null;if(isSafari()){var n=convertLocaleToSeolang(navigator?navigator.language:"en");localesJS&&localesJS[n][e]&&(t=localesJS[n][e].message).includes("$1")&&(t=t.replace(/\$1/g,a))}else browser.i18n&&(t=browser.i18n.getMessage(e,a));return t&&"string"==typeof t?t:""}}function onInstalled(e){e&&"function"==typeof e&&(isSafari()?safari.extension.settings.hasRun||(safari.extension.settings.hasRun=!0,e({reason:"install"})):browser.runtime.onInstalled.addListener(e))}function setUninstallURL(e){e&&"string"==typeof e&&(isSafari()||browser.runtime.setUninstallURL(e))}function redirectToNewTab(e){e&&"string"==typeof e&&(isSafari()?safari.application.activeBrowserWindow?safari.application.activeBrowserWindow.openTab().url=e:openNewWindow(e):browser.tabs.create({url:e}))}function openNewWindow(e){e&&"string"==typeof e&&(isSafari()?(safari.application.openBrowserWindow(),safari.application.activeBrowserWindow.activeTab.url=e):browser.windows.create({url:e}))}function isJSON(e){try{JSON.parse(e)}catch(e){return!1}return!0}window.browser=window.browser||window.chrome||window.safari;